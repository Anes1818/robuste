<!DOCTYPE html>
<html dir="rtl" lang="fr">
<head>
<meta name="description" content="Robuste eulma - Découvrez nos produits électroménagers de haute qualité avec garantie et livraison rapide en Algérie">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<!-- أيقونة SVG -->
<link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon">
<link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">

<!-- Theme color -->
<meta name="theme-color" content="#ff6600">
<title>Robuste eulma - Produit</title>

<!-- Google Fonts (Tajawal) -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">

<!-- Bootstrap RTL -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">

<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

<!-- EmailJS -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

<link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- نافبار مطابق للموقع الأصلي -->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top bg-white shadow-sm">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <img src="https://i.postimg.cc/7P7BK44r/f525e1dd-9f2c-4160-aed1-882a8b28b75c-20250703-131500-0000.png" 
                     alt="Robuste Logo" class="d-inline-block align-top" 
                     style="width: 180px; height: auto; max-height: 50px; object-fit:fill;">
                <span class="d-none d-lg-inline fw-bold fs-4 ms-2" style="color: #FF6B35;">ROBUSTE eulma</span>
            </a>
            
            <!-- زر دارك مود -->
            <div class="d-flex align-items-center me-3">
                <button class="theme-toggle" id="themeToggle" title="تبديل وضع الظلام">
                    <i class="bi bi-moon"></i>
                </button>
            </div>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item mx-2"><a class="nav-link" href="index.html">Accueil</a></li>
                    <li class="nav-item"><a class="nav-link" href="index.html#products">Produits</a></li>
                    <li class="nav-item"><a class="nav-link" href="index.html#reviews">Avis clients</a></li>
                    <li class="nav-item"><a class="nav-link" href="index.html#contact">Contactez-nous</a></li>
                </ul>
            </div>
            
            <!-- أيقونة السلة مع عداد -->
            <div class="cart-icon-container ms-lg-4">
                <span class="cart-label d-none d-lg-inline">panier</span>
                <a href="#" class="cart-btn position-relative" onclick="toggleCart(); return false;">
                    <i class="bi bi-cart3"></i>
                    <span class="position-absolute badge rounded-pill bg-danger" id="cartCount">0</span>
                </a>
            </div>
        </div>
    </nav>

    <!-- مؤشر الحالة -->
    <div class="status-indicator" id="statusIndicator" style="display: none;">
        <div class="alert alert-dismissible fade show" role="alert">
            <span id="statusMessage"></span>
            <button type="button" class="btn-close" onclick="hideStatus()"></button>
        </div>
    </div>

    <!-- محتوى صفحة المنتج -->
    <div class="container product-page mt-4">
        <div class="row" id="productContainer">
            <!-- سيتم تعبئة هذا القسم بالبيانات الديناميكية -->
            <div class="text-center py-5">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Chargement...</span>
                </div>
                <p class="mt-3">Chargement du produit...</p>
            </div>
        </div>
    </div>

    <!-- فوتر مطابق للموقع الأصلي -->
    <footer class="py-5 bg-dark text-white">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 mb-4">
                    <h5 class="mb-3">À propos de ROBUSTE</h5>
                    <p>Magasin spécialisé dans l'électroménager de haute qualité à prix compétitifs. Nous proposons les meilleurs produits et une livraison rapide.</p>
                    <div class="mt-3">
                        <a href="https://www.facebook.com/share/19QooaXfy8/" class="social-icon"><i class="bi bi-facebook"></i> </a>
                    </div>
                </div>
                <div class="col-lg-2 col-md-4 mb-4">
                    <h5 class="mb-3">Liens rapides</h5>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a href="index.html" class="text-white text-decoration-none">Accueil</a></li>
                        <li class="mb-2"><a href="index.html#products" class="text-white text-decoration-none">Produits</a></li>
                        <li class="mb-2"><a href="index.html#reviews" class="text-white text-decoration-none">Avis clients</a></li>
                        <li class="mb-2"><a href="index.html#contact" class="text-white text-decoration-none">Contactez-nous</a></li>
                    </ul>
                </div>
                <div class="col-lg-3 col-md-4 mb-4">
                    <h5 class="mb-3">Service client</h5>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a href="#" class="text-white text-decoration-none">FAQ</a></li>
                        <li class="mb-2"><a href="#" class="text-white text-decoration-none">Modes de paiement</a></li>
                        <li class="mb-2"><a href="#" class="text-white text-decoration-none">Conditions de garantie</a></li>
                    </ul>
                </div>
                <div class="col-lg-3 col-md-4 mb-4">
                    <h5 class="mb-3">Abonnez-vous à notre page</h5>
                    <p>Abonnez-vous pour recevoir les dernières offres</p>
                    <div class="mt-3">
                        <a href="https://www.facebook.com/share/19QooaXfy8/" class="btn btn-orange w-100" target="_blank">S'abonner</a>
                    </div>
                </div>
            </div>
            <hr class="my-4 bg-light">
            <div class="row">
                <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
                    <p class="mb-0">&copy; 2025 ROBUSTE. Tous droits réservés.</p>
                </div>
                <div class="col-md-6 text-center text-md-end">
                    <div class="d-flex flex-column flex-md-row align-items-center justify-content-md-end">
                        <p class="mb-2 mb-md-0 me-md-3">Paiement par carte gold disponible</p>
                        <img src="https://i.postimg.cc/bY06X2YN/logo-round.png" alt="Modes de paiement" style="width: 30px; height: auto;">
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- زر الواتساب -->
    <a href="https://wa.me/213656360457" class="whatsapp-btn" target="_blank">
        <i class="bi bi-whatsapp"></i>
    </a>

    <!-- سلة المشتريات -->
    <div class="offcanvas offcanvas-end" tabindex="-1" id="cartOffcanvas" aria-labelledby="cartOffcanvasLabel">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="cartOffcanvasLabel">Panier d'achat</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <div id="cartItems" class="mb-3">
                <div class="text-center py-4 text-muted" id="emptyCartMessage">
                    <i class="bi bi-cart-x display-4 d-block mb-2"></i>
                    Panier d'achat فارغة
                </div>
            </div>
            
            <div class="cart-summary border-top pt-3">
                <div class="d-flex justify-content-between mb-2">
                    <span>Total:</span>
                    <span id="cartTotal">0 د.ج</span>
                </div>
                <button class="btn btn-orange w-100" onclick="checkout()" id="checkoutBtn" disabled>
                    <i class="bi bi-bag-check"></i> Finaliser la commande
                </button>
            </div>
        </div>
    </div>

    <!-- نموذج الطلب -->
    <div class="modal fade" id="orderModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Commande produit</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="order-summary mb-4">
                        <h6 class="mb-3">Résumé de commande</h6>
                        <div class="d-flex align-items-center">
                            <img id="productImage" class="product-image-thumb me-3" src="" alt="Image produit">
                            <div>
                                <h5 id="productNameDisplay" class="mb-1"></h5>
                                <p id="productPrice" class="mb-0 text-primary fw-bold"></p>
                            </div>
                        </div>
                    </div>
                    <form id="orderForm">
                        <input type="hidden" id="productName">
                        <input type="hidden" id="productPriceValue">
                        <input type="hidden" id="productImageUrl">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="fullName" class="form-label">Nom et prénom<span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="fullName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="phone" class="form-label">Numéro de téléphone <span class="text-danger">*</span></label>
                                <input type="tel" class="form-control" id="phone" pattern="[0]{1}[5-7]{1}[0-9]{8}" required>
                                <small class="text-muted">EX: 0551234566</small>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="email" class="form-label">Email (optionnel)</label>
                                <input type="email" class="form-control" id="email">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="wilaya" class="form-label">Wilaya <span class="text-danger">*</span></label>
                                <select class="form-select" id="wilaya" required>
                                    <option value="">Choisissez votre wilaya</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="address" class="form-label">Adresse (optionnel)</label>
                            <textarea class="form-control" id="address" rows="2"></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Méthode de paiement</label>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="paymentMethod" id="cashOnDelivery" value="الدفع عند الاستلام" checked>
                                    <label class="form-check-label" for="cashOnDelivery">Paiement à la livraison</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="paymentMethod" id="onlinePayment" value="الدفع الإلكتروني">
                                    <label class="form-check-label" for="onlinePayment">Paiement en ligne</label>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    <button type="button" class="btn btn-orange" id="submitOrderBtn" onclick="submitOrder()">Confirmer la commande</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- استيراد main.js لإدارة السلة -->
    <script>
        // ============== تهيئة مشتركة ==============
        let orderModal = null;
        let cart = [];
        
        // دالة تحميل السلة من localStorage
        function loadCart() {
            try {
                const cartData = localStorage.getItem('robuste_cart');
                if (cartData) {
                    cart = JSON.parse(cartData);
                }
            } catch (e) {
                console.error('خطأ في تحميل سلة المشتريات:', e);
                cart = [];
            }
        }

        // تحديث عداد السلة
        function updateCartCount() {
            const cartCount = document.getElementById('cartCount');
            const checkoutBtn = document.getElementById('checkoutBtn');
            
            if (!cartCount || !checkoutBtn) return;
            
            const count = cart.reduce((total, item) => total + (item.quantity || 0), 0);
            cartCount.textContent = count;
            checkoutBtn.disabled = count === 0;
        }

        // إضافة منتج إلى السلة
        function addToCart(productName, productPrice, priceValue, productImages, productId) {
            const name = typeof productName === 'string' ? productName : 'Produit sans nom';
            const price = typeof priceValue === 'number' ? priceValue : 
                         typeof productPrice === 'number' ? productPrice : 0;
            const id = productId || Date.now().toString();
            
            let image = '';
            if (Array.isArray(productImages) && productImages.length > 0) {
                image = productImages[0];
            } else if (typeof productImages === 'string') {
                image = productImages;
            }
            
            const existingItemIndex = cart.findIndex(item => item.id === id);
            
            if (existingItemIndex >= 0) {
                cart[existingItemIndex].quantity += 1;
            } else {
                cart.push({
                    id: id,
                    name: name,
                    price: price,
                    image: image,
                    quantity: 1
                });
            }
            
            try {
                localStorage.setItem('robuste_cart', JSON.stringify(cart));
            } catch (e) {
                console.error('خطأ في حفظ السلة:', e);
                showStatus('Impossible de sauvegarder le panier', 'error');
            }
            
            updateCartCount();
            showStatus(`"${name}" ajouté au panier`, 'success');
        }

        // إظهار/إخفاء السلة
        function toggleCart() {
            loadCart();
            if (cart.length === 0) {
                showStatus('Le panier est vide', 'info');
                return;
            }
            
            try {
                const cartOffcanvas = new bootstrap.Offcanvas(document.getElementById('cartOffcanvas'));
                cartOffcanvas.show();
            } catch (e) {
                console.error('Erreur lors de l\'ouverture du panier:', e);
            }
        }

        // ============== جلب بيانات المنتج ==============
        async function loadProduct() {
            const urlParams = new URLSearchParams(window.location.search);
            const productId = parseInt(urlParams.get('pid'));
            
            if (!productId) {
                showProductError('ID de produit non spécifié');
                return;
            }
            
            try {
                const response = await fetch('products.json');
                if (!response.ok) throw new Error('Erreur lors du chargement des produits');
                
                const products = await response.json();
                const product = products.find(p => p.id === productId);
                
                if (!product) {
                    showProductError('Produit non trouvé');
                    return;
                }
                
                renderProduct(product);
            } catch (error) {
                console.error('Erreur:', error);
                showProductError('Erreur lors du chargement du produit');
            }
        }

        // عرض المنتج بتصميم أمازون
        function renderProduct(product) {
            const container = document.getElementById('productContainer');
            
            // حساب نسبة الخصم
            const discountPercentage = product.old_price ? 
                Math.round(((product.old_price - product.price) / product.old_price) * 100) : 0;
            
            // تصميم معرض الصور (بدون فجوات بيضاء)
            const galleryHTML = `
                <div class="col-lg-5 mb-4">
                    <div class="product-gallery position-sticky" style="top: 80px;">
                        <!-- الصورة الرئيسية -->
                        <div class="main-image-container bg-light rounded-3 mb-3" style="padding: 0; overflow: hidden;">
                            <img src="${product.images[0]}" alt="${product.title}" 
                                 id="mainProductImage" 
                                 class="w-100" 
                                 style="object-fit: contain; height: 400px;">
                        </div>
                        
                        <!-- الصور المصغرة -->
                        <div class="thumbnails d-flex flex-wrap gap-2">
                            ${product.images.map((img, index) => `
                                <div class="thumbnail ${index === 0 ? 'active' : ''}" 
                                     onclick="changeMainImage('${img}', this)"
                                     style="width: 80px; height: 80px; border-radius: 8px; overflow: hidden; cursor: pointer;">
                                    <img src="${img}" alt="Mini ${index + 1}" 
                                         class="w-100 h-100" 
                                         style="object-fit: cover;">
                                </div>
                            `).join('')}
                        </div>
                        
                        <!-- بطاقات الشحن والضمان -->
                        <div class="shipping-cards mt-4">
                            <div class="d-flex align-items-center mb-2">
                                <div class="me-3 text-success">
                                    <i class="bi bi-truck fs-5"></i>
                                </div>
                                <div>
                                    <small class="d-block fw-bold">Livraison GRATUITE</small>
                                    <small class="text-muted">Dès 5000 DA</small>
                                </div>
                            </div>
                            <div class="d-flex align-items-center">
                                <div class="me-3 text-warning">
                                    <i class="bi bi-shield-check fs-5"></i>
                                </div>
                                <div>
                                    <small class="d-block fw-bold">Garantie 2 ans</small>
                                    <small class="text-muted">Service après-vente inclus</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // تصميم معلومات المنتج
            const infoHTML = `
                <div class="col-lg-7 mb-4">
                    <div class="product-info p-3">
                        <!-- العنوان والتصنيف -->
                        <div class="mb-3">
                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="index.html" class="text-decoration-none">Accueil</a></li>
                                    <li class="breadcrumb-item"><a href="index.html#products" class="text-decoration-none">Produits</a></li>
                                    <li class="breadcrumb-item active">${product.category}</li>
                                </ol>
                            </nav>
                            <h1 class="product-title fs-3 fw-bold mb-2">${product.title}</h1>
                            <div class="d-flex align-items-center">
                                <div class="stars text-warning me-2">
                                    <i class="bi bi-star-fill"></i>
                                    <i class="bi bi-star-fill"></i>
                                    <i class="bi bi-star-fill"></i>
                                    <i class="bi bi-star-fill"></i>
                                    <i class="bi bi-star-half"></i>
                                </div>
                                <span class="text-muted">4.2 · 128 avis</span>
                            </div>
                        </div>
                        
                        <!-- السعر -->
                        <div class="price-section mb-4 p-3 bg-light rounded-3">
                            ${product.old_price ? `
                                <div class="d-flex align-items-center mb-2">
                                    <span class="badge bg-danger me-2">-${discountPercentage}%</span>
                                    <span class="text-decoration-line-through text-muted">${product.old_price.toLocaleString()} DA</span>
                                </div>
                            ` : ''}
                            <div class="d-flex align-items-center">
                                <span class="current-price fs-2 fw-bold text-primary">${product.price.toLocaleString()} DA</span>
                            </div>
                            <small class="text-muted d-block mt-1">TVA incluse</small>
                        </div>
                        
                        <!-- الألوان والأحجام (إذا وجدت) -->
                        ${product.variants ? `
                            <div class="variants mb-4">
                                <h6 class="fw-bold mb-2">Couleurs disponibles:</h6>
                                <div class="d-flex gap-2">
                                    ${product.variants.map(variant => `
                                        <button class="btn btn-sm btn-outline-secondary border-2 rounded-pill">
                                            ${variant}
                                        </button>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                        
                        <!-- الزر الرئيسي للشراء -->
                        <div class="action-buttons mb-4">
                            <button class="btn btn-warning w-100 py-3 fw-bold mb-2" 
                                    onclick="addToCartDirect('${product.id}')"
                                    style="background: linear-gradient(to bottom, #FFD814, #F7CA00); border: none;">
                                <i class="bi bi-cart-plus"></i> Ajouter au panier
                            </button>
                            
                            <button class="btn btn-orange w-100 py-3 fw-bold"
                                    onclick="buyNowDirect('${product.id}')">
                                <i class="bi bi-bag-check"></i> Acheter maintenant
                            </button>
                        </div>
                        
                        <!-- معلومات المخزون -->
                        <div class="stock-info mb-4 p-3 ${product.stock > 0 ? 'bg-success bg-opacity-10 border border-success rounded-3' : 'bg-danger bg-opacity-10 border border-danger rounded-3'}">
                            <div class="d-flex align-items-center">
                                <i class="bi ${product.stock > 0 ? 'bi-check-circle-fill text-success' : 'bi-x-circle-fill text-danger'} me-2 fs-5"></i>
                                <div>
                                    <span class="fw-bold">${product.stock > 0 ? 'En stock' : 'Rupture de stock'}</span>
                                    ${product.stock > 0 ? `
                                        <div class="progress mt-1" style="height: 6px;">
                                            <div class="progress-bar bg-success" 
                                                 style="width: ${Math.min(product.stock * 10, 100)}%"></div>
                                        </div>
                                        <small class="text-muted">${product.stock} unité(s) disponible(s)</small>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                        
                        <!-- المميزات الرئيسية -->
                        <div class="key-features mb-4">
                            <h6 class="fw-bold mb-3">Caractéristiques principales:</h6>
                            <div class="row g-2">
                                ${product.features.slice(0, 4).map(feature => `
                                    <div class="col-6">
                                        <div class="d-flex align-items-start">
                                            <i class="bi bi-check-circle-fill text-success mt-1 me-2"></i>
                                            <span>${feature}</span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <!-- الضمان والشحن -->
                        <div class="guarantee-cards row g-2 mb-4">
                            <div class="col-6">
                                <div class="border rounded-3 p-3 text-center h-100">
                                    <i class="bi bi-shield-check text-primary fs-4 d-block mb-2"></i>
                                    <small class="fw-bold d-block">Garantie 2 ans</small>
                                    <small class="text-muted">Couverture complète</small>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="border rounded-3 p-3 text-center h-100">
                                    <i class="bi bi-arrow-repeat text-primary fs-4 d-block mb-2"></i>
                                    <small class="fw-bold d-block">Retour gratuit</small>
                                    <small class="text-muted">Sous 14 jours</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // تصميم التفاصيل والتقييمات
            const detailsHTML = `
                <div class="col-12 mt-4">
                    <div class="product-details bg-white rounded-3 shadow-sm p-4">
                        <!-- التبويبات -->
                        <ul class="nav nav-tabs mb-4" id="productTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="description-tab" data-bs-toggle="tab" data-bs-target="#description" type="button">
                                    Description
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="features-tab" data-bs-toggle="tab" data-bs-target="#features" type="button">
                                    Caractéristiques
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="specs-tab" data-bs-toggle="tab" data-bs-target="#specs" type="button">
                                    Spécifications
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="reviews-tab" data-bs-toggle="tab" data-bs-target="#reviews" type="button">
                                    Avis (128)
                                </button>
                            </li>
                        </ul>
                        
                        <!-- محتوى التبويبات -->
                        <div class="tab-content" id="productTabsContent">
                            <!-- وصف المنتج -->
                            <div class="tab-pane fade show active" id="description" role="tabpanel">
                                <div class="description-content">
                                    <h5 class="fw-bold mb-3">${product.title}</h5>
                                    <div class="row">
                                        <div class="col-md-8">
                                            <p class="lead">${product.description_short}</p>
                                            <p>${product.description_long}</p>
                                            
                                            <!-- قائمة المميزات -->
                                            <div class="mt-4">
                                                <h6 class="fw-bold mb-3">Pourquoi choisir ce produit?</h6>
                                                <ul class="list-unstyled">
                                                    ${product.features.map(feature => `
                                                        <li class="mb-2">
                                                            <i class="bi bi-check-circle-fill text-success me-2"></i>
                                                            ${feature}
                                                        </li>
                                                    `).join('')}
                                                </ul>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="card border-0 bg-light">
                                                <div class="card-body">
                                                    <h6 class="card-title fw-bold">Points forts</h6>
                                                    <ul class="list-unstyled">
                                                        <li class="mb-2"><i class="bi bi-star-fill text-warning me-2"></i>Haute performance</li>
                                                        <li class="mb-2"><i class="bi bi-star-fill text-warning me-2"></i>Économie d'énergie</li>
                                                        <li class="mb-2"><i class="bi bi-star-fill text-warning me-2"></i>Facile à utiliser</li>
                                                        <li class="mb-2"><i class="bi bi-star-fill text-warning me-2"></i>Design moderne</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- المميزات -->
                            <div class="tab-pane fade" id="features" role="tabpanel">
                                <div class="row">
                                    ${product.features.map((feature, index) => `
                                        <div class="col-md-6 mb-3">
                                            <div class="d-flex">
                                                <div class="me-3">
                                                    <i class="bi bi-check2-circle text-primary fs-4"></i>
                                                </div>
                                                <div>
                                                    <h6 class="fw-bold">Caractéristique ${index + 1}</h6>
                                                    <p class="text-muted mb-0">${feature}</p>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <!-- المواصفات -->
                            <div class="tab-pane fade" id="specs" role="tabpanel">
                                <div class="table-responsive">
                                    <table class="table table-bordered">
                                        <tbody>
                                            <tr>
                                                <td class="fw-bold" style="width: 30%;">Marque</td>
                                                <td>Robuste</td>
                                            </tr>
                                            <tr>
                                                <td class="fw-bold">Modèle</td>
                                                <td>${product.title.split(' ')[0]}</td>
                                            </tr>
                                            <tr>
                                                <td class="fw-bold">Catégorie</td>
                                                <td>${product.category}</td>
                                            </tr>
                                            <tr>
                                                <td class="fw-bold">Garantie</td>
                                                <td>2 ans</td>
                                            </tr>
                                            <tr>
                                                <td class="fw-bold">Poids</td>
                                                <td>2.5 kg</td>
                                            </tr>
                                            <tr>
                                                <td class="fw-bold">Dimensions</td>
                                                <td>30 × 20 × 15 cm</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            
                            <!-- التقييمات -->
                            <div class="tab-pane fade" id="reviews" role="tabpanel">
                                <div class="row">
                                    <div class="col-md-4 mb-4">
                                        <div class="text-center">
                                            <div class="display-4 fw-bold text-warning mb-2">4.2</div>
                                            <div class="stars mb-2">
                                                <i class="bi bi-star-fill fs-4"></i>
                                                <i class="bi bi-star-fill fs-4"></i>
                                                <i class="bi bi-star-fill fs-4"></i>
                                                <i class="bi bi-star-fill fs-4"></i>
                                                <i class="bi bi-star-half fs-4"></i>
                                            </div>
                                            <p class="text-muted">Basé sur 128 avis</p>
                                        </div>
                                    </div>
                                    <div class="col-md-8">
                                        <div class="review-item mb-4">
                                            <div class="d-flex justify-content-between mb-2">
                                                <div>
                                                    <strong>Omar B.</strong>
                                                    <div class="stars text-warning">
                                                        <i class="bi bi-star-fill"></i>
                                                        <i class="bi bi-star-fill"></i>
                                                        <i class="bi bi-star-fill"></i>
                                                        <i class="bi bi-star-fill"></i>
                                                        <i class="bi bi-star-fill"></i>
                                                    </div>
                                                </div>
                                                <small class="text-muted">Il y a 2 jours</small>
                                            </div>
                                            <p>"Produit de très haute qualité, je recommande vivement!"</p>
                                        </div>
                                        <div class="review-item mb-4">
                                            <div class="d-flex justify-content-between mb-2">
                                                <div>
                                                    <strong>Sarah M.</strong>
                                                    <div class="stars text-warning">
                                                        <i class="bi bi-star-fill"></i>
                                                        <i class="bi bi-star-fill"></i>
                                                        <i class="bi bi-star-fill"></i>
                                                        <i class="bi bi-star-fill"></i>
                                                        <i class="bi bi-star-half"></i>
                                                    </div>
                                                </div>
                                                <small class="text-muted">Il y a 1 semaine</small>
                                            </div>
                                            <p>"Livraison rapide et produit conforme à la description."</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            container.innerHTML = galleryHTML + infoHTML + detailsHTML;
            
            // تهيئة التبويبات
            const triggerTabList = [].slice.call(document.querySelectorAll('#productTabs button'));
            triggerTabList.forEach(function (triggerEl) {
                var tabTrigger = new bootstrap.Tab(triggerEl);
                triggerEl.addEventListener('click', function (event) {
                    event.preventDefault();
                    tabTrigger.show();
                });
            });
        }

        // تغيير الصورة الرئيسية
        function changeMainImage(src, element) {
            document.getElementById('mainProductImage').src = src;
            
            // إزالة النشط من جميع الصور المصغرة
            document.querySelectorAll('.thumbnail').forEach(thumb => {
                thumb.classList.remove('active');
            });
            
            // إضافة النشط للصورة المحددة
            element.classList.add('active');
        }

        // ============== دوال الشراء ==============
        async function addToCartDirect(productId) {
            try {
                const response = await fetch('products.json');
                if (!response.ok) throw new Error('Erreur lors du chargement des produits');
                
                const products = await response.json();
                const product = products.find(p => p.id == productId);
                
                if (product) {
                    addToCart(
                        product.title,
                        `${product.price.toLocaleString()} DA`,
                        product.price,
                        product.images,
                        product.id
                    );
                } else {
                    showStatus('Produit non trouvé', 'error');
                }
            } catch (error) {
                console.error('Erreur:', error);
                showStatus('Erreur lors de l\'ajout au panier', 'error');
            }
        }

        async function buyNowDirect(productId) {
            try {
                const response = await fetch('products.json');
                if (!response.ok) throw new Error('Erreur lors du chargement des produits');
                
                const products = await response.json();
                const product = products.find(p => p.id == productId);
                
                if (product) {
                    addToCart(
                        product.title,
                        `${product.price.toLocaleString()} DA`,
                        product.price,
                        product.images,
                        product.id
                    );
                    
                    // الانتقال مباشرة إلى السلة
                    toggleCart();
                } else {
                    showStatus('Produit non trouvé', 'error');
                }
            } catch (error) {
                console.error('Erreur:', error);
                showStatus('Erreur lors de la commande', 'error');
            }
        }

        // ============== دوال مشتركة مع main.js ==============
        function checkout() {
            loadCart();
            if (cart.length === 0) {
                showStatus('Le panier est vide', 'error');
                return;
            }
            
            // إخفاء سلة المشتريات
            const cartOffcanvas = bootstrap.Offcanvas.getInstance(document.getElementById('cartOffcanvas'));
            if (cartOffcanvas) {
                cartOffcanvas.hide();
            }
            
            // إعداد بيانات الطلب
            const firstItem = cart[0];
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            // ملء نموذج الطلب
            document.getElementById('productName').value = `${cart.length} produits différents`;
            document.getElementById('productPriceValue').value = total;
            document.getElementById('productImageUrl').value = firstItem.image;
            
            document.getElementById('productNameDisplay').textContent = `${cart.length} produits différents`;
            document.getElementById('productPrice').textContent = `${total.toLocaleString()} DA`;
            document.getElementById('productImage').src = firstItem.image;
            
            // تعبئة قائمة الولايات
            populateWilayas();
            
            // إعادة تعيين النموذج
            document.getElementById('orderForm').reset();
            document.getElementById('cashOnDelivery').checked = true;
            
            // إظهار نموذج الطلب
            if (!orderModal) {
                orderModal = new bootstrap.Modal(document.getElementById('orderModal'));
            }
            orderModal.show();
        }

        // دالة إرسال الطلب
        async function submitOrder() {
            // نفس دالة submitOrder من main.js
            // يمكن استيرادها أو إعادة كتابتها هنا
            showStatus('Fonctionnalité de commande activée', 'success');
        }

        // تعبئة قائمة الولايات
        function populateWilayas() {
            const wilayas = [
                "أدرار", "الشلف", "الأغواط", "أم البواقي", "باتنة", "بجاية", "بسكرة", "بشار", "البليدة",
                "البويرة", "تمنراست", "تبسة", "تلمسان", "تيارت", "تيزي وزو", "الجزائر", "الجلفة", "جيجل",
                "سطيف", "سعيدة", "سكيكدة", "سيدي بلعباس", "عنابة", "قالمة", "قسنطينة", "المدية", "مستغانم",
                "المسيلة", "معسكر", "ورقلة", "وهران", "البيض", "إليزي", "برج بوعريريج", "بومرداس", "الطارف",
                "تيندوف", "تيسمسيلت", "الوادي", "خنشلة", "سوق أهراس", "تيبازة", "ميلة", "عين الدفلى", "النعامة",
                "عين تموشنت", "غرداية", "غليزان"
            ];
            
            const wilayaSelect = document.getElementById('wilaya');
            if (wilayaSelect && wilayaSelect.options.length <= 1) {
                wilayas.forEach(wilaya => {
                    const option = document.createElement('option');
                    option.value = wilaya;
                    option.textContent = wilaya;
                    wilayaSelect.appendChild(option);
                });
            }
        }

        // عرض رسالة الخطأ
        function showProductError(message) {
            const container = document.getElementById('productContainer');
            container.innerHTML = `
                <div class="col-12 text-center py-5">
                    <i class="bi bi-exclamation-triangle display-1 text-danger"></i>
                    <h3 class="mt-3">${message}</h3>
                    <p class="mb-4">Nous n'avons pas pu trouver le produit demandé.</p>
                    <a href="index.html" class="btn btn-orange btn-lg">
                        <i class="bi bi-arrow-left"></i> Retour à l'accueil
                    </a>
                </div>
            `;
        }

        // دوال عرض الحالة
        function showStatus(message, type) {
            const indicator = document.getElementById('statusIndicator');
            const messageElement = document.getElementById('statusMessage');
            
            messageElement.innerHTML = message;
            
            const alert = indicator.querySelector('.alert');
            alert.className = 'alert alert-dismissible fade show';
            
            switch (type) {
                case 'success':
                    alert.classList.add('alert-success', 'order-confirmation');
                    break;
                case 'error':
                    alert.classList.add('alert-danger', 'order-error');
                    break;
                case 'info':
                    alert.classList.add('alert-info');
                    break;
                default:
                    alert.classList.add('alert-info');
            }
            
            indicator.style.display = 'block';
            
            if (type === 'success') {
                setTimeout(hideStatus, 5000);
            }
        }

        function hideStatus() {
            document.getElementById('statusIndicator').style.display = 'none';
        }

        // ============== تهيئة وضع الظلام ==============
        function initDarkMode() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            
            const themeIcon = document.querySelector('#themeToggle i');
            if (savedTheme === 'dark') {
                themeIcon.className = 'bi bi-sun';
                themeIcon.parentElement.title = 'تفعيل وضع النهار';
            } else {
                themeIcon.className = 'bi bi-moon';
                themeIcon.parentElement.title = 'تفعيل وضع الظلام';
            }
        }

        function toggleDarkMode() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            
            const themeIcon = document.querySelector('#themeToggle i');
            if (newTheme === 'dark') {
                themeIcon.className = 'bi bi-sun';
                themeIcon.parentElement.title = 'تفعيل وضع النهار';
            } else {
                themeIcon.className = 'bi bi-moon';
                themeIcon.parentElement.title = 'تفعيل وضع الظلام';
            }
            
            localStorage.setItem('theme', newTheme);
        }

        // ============== تهيئة الصفحة ==============
        document.addEventListener('DOMContentLoaded', function() {
            // تهيئة وضع الظلام
            initDarkMode();
            document.getElementById('themeToggle').addEventListener('click', toggleDarkMode);
            
            // تحميل السلة
            loadCart();
            updateCartCount();
            
            // تحميل المنتج
            loadProduct();
        });
    </script>
</body>
</html>
